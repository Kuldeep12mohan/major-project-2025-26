generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  TEACHER
  STUDENT
}

enum CourseType {
  OE
  DE
  CORE
  HM
}

enum RegStatus {
  PENDING
  VERIFIED
  APPROVED
  REJECTED
}

model User {
  id       String   @id @default(uuid())
  email    String   @unique
  password String
  name     String?
  role     Role

  studentProfile StudentProfile?
  teacherProfile TeacherProfile?
  adminProfile   AdminProfile?
}

model StudentProfile {
  id        String  @id @default(uuid())
  user      User    @relation(fields: [userId], references: [id])
  userId    String  @unique

  enrollNo   String @unique
  facultyNo  String @unique
  semester   Int
  dept       String

  tempRegistrations TempRegistration[]
  registrations     Registration[]
}

model TeacherProfile {
  id          String           @id @default(uuid())
  user        User             @relation(fields: [userId], references: [id])
  userId      String           @unique

  employeeId  String @unique
  designation String
  dept        String

  courses     Course[]         @relation("TeacherCourses")
  verifications TempRegistration[] @relation("VerifierRelation")
}

model AdminProfile {
  id       String           @id @default(uuid())
  user     User             @relation(fields: [userId], references: [id])
  userId   String           @unique

  adminId  String @unique
  position String?

  approvals TempRegistration[] @relation("AdminRelation")
}

model Course {
  id        String     @id @default(uuid())
  code      String     @unique
  title     String
  type      CourseType @default(CORE)
  semester  Int
  active    Boolean    @default(true)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  tempRegistrations TempRegistration[]
  registrations     Registration[]
  teachers          TeacherProfile[] @relation("TeacherCourses")
}

model TempRegistration {
  id         String           @id @default(uuid())
  student    StudentProfile   @relation(fields: [studentId], references: [id])
  studentId  String
  course     Course           @relation(fields: [courseId], references: [id])
  courseId   String
  status     RegStatus        @default(PENDING)

  verifier   TeacherProfile?  @relation("VerifierRelation", fields: [verifierId], references: [id])
  verifierId String?

  admin      AdminProfile?    @relation("AdminRelation", fields: [adminId], references: [id])
  adminId    String?

  createdAt  DateTime         @default(now())
  updatedAt  DateTime         @updatedAt
}

model Registration {
  id        String          @id @default(uuid())
  student   StudentProfile  @relation(fields: [studentId], references: [id])
  studentId String
  course    Course          @relation(fields: [courseId], references: [id])
  courseId  String
  semester  Int
  year      Int
  createdAt DateTime        @default(now())
}
